<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Become Pope</title>
<link id="currentStyle" type="text/css" href="light.css" rel="Stylesheet"/>
<script type="text/javascript" src="jq/jquery-1.12.3.min.js"></script>
<script type="text/javascript" src="jq/lz-string.min.js"></script>

</head>
<body>

<script type="text/javascript">

  //PLAYER
  var holiness=0;
  var holiness_limit=1000;
  var holiness_level=0;
  var rank="<b>boxmaker</b>";
  var money=0;

  //ENTITIES
  var boxes=0;
  var boxmakers=0;
  var monks=0;
  var churches=0;

  //LOOPS
  var boxmaker_interval;
  var monk_interval;
  var pray_interval;
  var makebox_interval;
  var wedding_interval;
  var holywater_interval;
  var pilgrim_interval;
  var sins_interval;
  var tax_interval;
  var tele_interval;
  var dj_interval;

  //PRICES
  var boxmaker_upgrade_price=10;
  var church_upgrade_price=1000000;
  var small_church_upgrade_price=100000;//fixed price, no need to save
  var monastery_upgrade_price=500000;
  var monk_upgrade_price=1000;
  var cathedral_upgrade_price=50000000;//fixed price, no need to save
  var vatican_upgrade_price=500000000;//fixed price, no need to save
  var bishop_upgrade_price=500000;
  var pope_upgrade_price=1000000000;

  //PRESTIGE
  var prestige_limit=0;
  var prestige_progress=0;
  var prestige_limit_flag=0;//have we reached prestige limit

  //MANUAL
  var holywater_speed=2000;
  var wedding_speed=1000;
  var sins_speed=4000;
  var tax_speed=3000;
  var dj_speed=3000;

  //PRESTIGE MULTIPLIERS
  var speed_multiplier=1;
  var makeboxing_multiplier=1;
  var praying_multiplier=1;
  var pilgrimage=0;
  var tax=1;

  //UI
  var store_table_flag=0;
  var small_church_block_flag=1;//shown by default
  var monastery_block_flag=0;
  var cathedral_block_flag=0;
  var css_flag=2;//dark by default
  var prestige_hide_flag=0;//not hidden by default
  var statue_upgrade_flag=0;
  var vatican_upgrade_flag=0;
  var bishop_upgrade_flag=0;

  //CACHE
  var makebox_pb;
  var makebox_button;
  var boxes_label;
  var store_table;
  var boxmaker_upgrade;
  var church_upgrade;
  var church_label;
  var boxmaker_label;
  var boxmaker_pb;
  var rank_label;
  var prestige_table;
  var prestige_counter;
  var prestige_limit_label;
  var prestige_label;
  var money_label;
  var wedding_upgrade;
  var wedding_pb;
  var wedding_block;
  var pray_button;
  var holiness_block;
  var dark;
  var light;
  var small_church_upgrade;
  var small_church_block;
  var church_block;
  var monastery_block;
  var holiness_label;
  var monastery_upgrade;
  var monk_block;
  var monk_label;
  var monk_upgrade;
  var monk_pb;
  var holiness_limit_label;
  var holywater_pb;
  var holywater_block;
  var holywater_upgrade;
  var pilgrimage_prestige_upgrade;
  var speed_prestige_upgrade;
  var makeboxing_prestige_upgrade;
  var resume_game;
  var resume_game_block;
  var player_table;
  var inventory_table;
  var sins_pb;
  var sins_block;
  var sins_upgrade;
  var tax_pb;
  var tax_block;
  var tax_upgrade;
  var cathedral_block;
  var cathedral_upgrade;
  var tax_prestige_upgrade;
  var current_tax_label;
  var tele_pb;
  var tele_block;
  var tele_upgrade;
  var prestige_hide;
  var praying_prestige_upgrade;
  var holiness_complete_block;
  var dj_pb;
  var dj_block;
  var dj_upgrade;
  var statue_block;
  var statue_upgrade;
  var vatican_block;
  var vatican_upgrade;
  var bishop_block;
  var bishop_upgrade;
  var pope_block;
  var pope_upgrade;
  var holiness_sign;
  var reset_game;

  $(document).ready(function(){

    //CACHE
    reset_game=$("#reset_game");
    holiness_sign=$("#holiness_sign");
    pope_block=$("#pope_block");
    pope_upgrade=$("#pope_upgrade");
    bishop_block=$("#bishop_block");
    bishop_upgrade=$("#bishop_upgrade");
    vatican_block=$("#vatican_block");
    vatican_upgrade=$("#vatican_upgrade");
    statue_block=$("#statue_block");
    statue_upgrade=$("#statue_upgrade");
    dj_pb=$("#dj_pb");
    dj_block=$("#dj_block");
    dj_upgrade=$("#dj_upgrade");
    holiness_complete_block=$("#holiness_complete_block");
    praying_prestige_upgrade=$("#praying_prestige_upgrade");
    prestige_hide=$("#prestige_hide");
    tele_pb=$("#tele_pb");
    tele_block=$("#tele_block");
    tele_upgrade=$("#tele_upgrade");
    current_tax_label=$("#current_tax_label");
    tax_prestige_upgrade=$("#tax_prestige_upgrade");
    cathedral_upgrade=$("#cathedral_upgrade");
    cathedral_block=$("#cathedral_block");
    tax_pb=$("#tax_pb");
    tax_block=$("#tax_block");
    tax_upgrade=$("#tax_upgrade");
    sins_pb=$("#sins_pb");
    sins_block=$("#sins_block");
    sins_upgrade=$("#sins_upgrade");
    inventory_table=$("#inventory_table");
    player_table=$("#player_table");
    resume_game=$("#resume_game");
    resume_game_block=$("#resume_game_block");
    makeboxing_prestige_upgrade=$("#makeboxing_prestige_upgrade");
    speed_prestige_upgrade=$("#speed_prestige_upgrade");
    pilgrimage_prestige_upgrade=$("#pilgrimage_prestige_upgrade");
    holywater_upgrade=$("#holywater_upgrade");
    holywater_block=$("#holywater_block");
    holywater_pb=$("#holywater_pb");
    holiness_limit_label=$("#holiness_limit_label");
    monk_pb=$("#monk_pb");
    monk_upgrade=$("#monk_upgrade");
    monk_label=$("#monk_label");
    monk_block=$("#monk_block");
    monastery_upgrade=$("#monastery_upgrade");
    holiness_label=$("#holiness_label");
    monastery_block=$("#monastery_block");
    church_block=$("#church_block");
    small_church_block=$("#small_church_block");
    small_church_upgrade=$("#small_church_upgrade");
    dark=$("#dark");
    light=$("#light");
    holiness_block=$("#holiness_block");
    pray_button=$("#pray_button");
    wedding_block=$("#wedding_block");
    wedding_upgrade=$("#wedding_upgrade");
    wedding_pb=$("#wedding_pb");
    money_label=$("#money_label");
    prestige_label=$("#prestige_label");
    prestige_limit_label=$("#prestige_limit_label");
    prestige_counter=$("#prestige_counter");
    prestige_table=$("#prestige_table");
    rank_label=$("#rank_label");
    boxmaker_pb=$("#boxmaker_pb");
    boxmaker_label=$("#boxmaker_label");
    church_label=$("#church_label");
    church_upgrade=$("#church_upgrade");
    boxmaker_upgrade=$("#boxmaker_upgrade");
    store_table=$("#store_table");
    boxes_label=$("#boxes_label");
    makebox_pb=$("#makebox_pb");
    makebox_button=$("#makebox_button");

    if(localStorage.getItem("popeGameData")){
      resume_game_block.show();
      player_table.hide();
      inventory_table.hide();
    }else{
      Init();
    }

    //TESTING
    //money=10000000000;InventoryUpdate();
    //store_table.show();

    $("html").keydown(function( event ) {
			  switch (event.key){
					case "q":
						PrestigeUpdate(100000);
					break;
					case "w":
						money+=100000000;InventoryUpdate();
					break;
					case "s":
						SaveGame();
					break;
				  }
			});

    //CSS SWITCH
    dark.click(function(){
      $("#currentStyle").attr( "href", $(this).attr("id") + ".css" );
      $(this).hide();
      light.show();
      css_flag=2;
    });
    light.click(function(){
      $("#currentStyle").attr( "href", $(this).attr("id") + ".css" );
      $(this).hide();
      dark.show();
      css_flag=1;
    });


    prestige_hide.click(function(){
      if(prestige_hide_flag==0){
        $(".prestige_item").hide();
        prestige_hide_flag=1;
        prestige_hide.html("Show Prestige &#x25BC;");
      }else{
        $(".prestige_item").show();
        prestige_hide_flag=0;
        prestige_hide.html("Hide Prestige &#x25B2;");
      }

    });

    resume_game.click(function(){
      resume_game_block.hide();
      player_table.show();
      inventory_table.show();
      PlayAudio(1);
      LoadGame();
    });

    boxmaker_upgrade.click(function(){
      PlayAudio(1);


      boxmakers++;
      boxmaker_label.text(boxmakers);

      boxmaker_upgrade_price=Math.floor(boxmaker_upgrade_price+boxmaker_upgrade_price*0.8);
      boxmaker_upgrade.text( numT(boxmaker_upgrade_price) + " boxes" );
      InventoryUpdate();

      if(boxmakers==1){
        boxmaker();
      }



    });

    monk_upgrade.click(function(){
      PlayAudio(1);

      monks++;
      monk_label.text(monks);

      money=money-monk_upgrade_price;
      InventoryUpdate();

      monk_upgrade_price=Math.floor(monk_upgrade_price+monk_upgrade_price*0.5);
      monk_upgrade.text( "$" + numT(monk_upgrade_price) );
      InventoryUpdate();

      if(monks==1){
      Monk();
      }
    });

    makebox_button.click(function(){
      PlayAudio(1);
      makebox();
    });

    pray_button.click(function(){
      PlayAudio(1);
      Pray();
    });

    wedding_upgrade.click(function(){

      var num=0;

      PlayAudio(1);

      wedding_pb.show();
      wedding_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      wedding_interval=setInterval(function(){
        num++;
        progress(num,wedding_pb);

        if(num>=100){
          clearInterval(wedding_interval);
          progress(0,wedding_pb);
          //wedding_pb.hide();
          wedding_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
          money+=50000;
          PrestigeUpdate(1000);
          InventoryUpdate();
          PlayAudio(4);
        }



      },wedding_speed*speed_multiplier);
    });

    dj_upgrade.click(function(){

      var num=0;

      PlayAudio(1);

      dj_pb.show();
      dj_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      dj_interval=setInterval(function(){
        num++;
        progress(num,dj_pb);

        if(num>=100){
          clearInterval(dj_interval);
          progress(0,dj_pb);
          //dj_pb.hide();
          dj_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
          money+=500000;
          boxes+=Math.floor((Math.random() * 100) + 1);
          PrestigeUpdate(100000);
          InventoryUpdate();
          PlayAudio(4);
        }

      },dj_speed*speed_multiplier);
    });

    holywater_upgrade.click(function(){

      var num=0;

      PlayAudio(1);

      holywater_pb.show();
      holywater_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      holywater_interval=setInterval(function(){
        num++;
        progress(num,holywater_pb);

        if(num>=100){
          clearInterval(holywater_interval);
          progress(0,holywater_pb);
          //holywater_pb.hide();
          holywater_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
          money+=100000;
          PrestigeUpdate(1000);
          InventoryUpdate();
          PlayAudio(4);
        }



      },holywater_speed*speed_multiplier);
    });

    sins_upgrade.click(function(){

      var num=0;

      PlayAudio(1);

      sins_pb.show();
      sins_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      sins_interval=setInterval(function(){
        num++;
        progress(num,sins_pb);

        if(num>=100){
          clearInterval(sins_interval);
          progress(0,sins_pb);
          //sins_pb.hide();
          sins_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
          money+=200000;
          PrestigeUpdate(5000);
          InventoryUpdate();
          PlayAudio(4);
        }



      },sins_speed*speed_multiplier);
    });

    tax_upgrade.click(function(){

      var num=0;

      PlayAudio(1);

      tax_pb.show();
      tax_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      tax_interval=setInterval(function(){
        num++;
        progress(num,tax_pb);

        if(num>=100){
          clearInterval(tax_interval);
          progress(0,tax_pb);
          //tax_pb.hide();
          tax_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
          money+=boxes*tax;
          PrestigeUpdate(10000);
          InventoryUpdate();
          PlayAudio(4);
        }



      },tax_speed*speed_multiplier);
    });

    tele_upgrade.click(function(){

      var num=0;

      PlayAudio(1);

      tele_pb.show();
      tele_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      tele_interval=setInterval(function(){
        num++;
        progress(num,tele_pb);

        if(num>=100){
          clearInterval(tele_interval);
          progress(0,tele_pb);
          //tele_pb.hide();
          tele_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
          boxes+=Math.floor((Math.random() * 3) + 1)*100000;
          PrestigeUpdate(100000);
          InventoryUpdate();
          PlayAudio(4);
        }



      },500);
    });

    statue_upgrade.click(function(){
      PlayAudio(1);
      money+=300000000;

      statue_upgrade_flag=2;
      statue_block.hide();
      pilgrimage=2;

      clearInterval(pilgrim_interval);


      InventoryUpdate();
    });

    pope_upgrade.click(function(){
      PlayAudio(9);

      rank="<b>Pope</b>";
      rank_label.html(rank);

      pope_block.hide();
      bishop_block.hide();
      //bishop_upgrade_flag=2;

      setTimeout('EndGame();',3000);
    });

    vatican_upgrade.click(function(){
      PlayAudio(8);

      rank="<b>Cardinal</b>";
      rank_label.html(rank);

      money=money-vatican_upgrade_price;

      vatican_upgrade_flag=2;
      vatican_block.hide();

      bishop_upgrade_flag=1;
      bishop_block.show();
      pope_block.show();

      InventoryUpdate();
    });

    bishop_upgrade.click(function(){
      PlayAudio(1);

      money=money-bishop_upgrade_price;

      bishop_upgrade_price=Math.floor(bishop_upgrade_price+bishop_upgrade_price*0.15);
      bishop_upgrade.text( "$" + numT(bishop_upgrade_price) );

      boxes+=Math.floor((Math.random() * 10000000) + 10000000);
      InventoryUpdate();

    });

    monastery_upgrade.click(function(){
      PlayAudio(5);
      money=money-monastery_upgrade_price;
      InventoryUpdate();

      monk_block.show();
      monastery_block.hide();
      monastery_block_flag=2;//so that it's never shown again
    });

    small_church_upgrade.click(function(){

      money=money-small_church_upgrade_price;

      PlayAudio(5);

      holiness_block.show();
      pray_button.show();
      makebox_button.hide();
      if(boxmakers<=0){
        boxmakers++;
        boxmaker_label.text(boxmakers);
        boxmaker();
      }

      rank="<b>Local Minister</b>";
      rank_label.html(rank);
      wedding_block.show();
      church_block.show();
      small_church_block.hide();
      small_church_block_flag=2;


      InventoryUpdate();

    });

    church_upgrade.click(function(){
      PlayAudio(5);
      BuildChurch();
    });

    cathedral_upgrade.click(function(){
      PlayAudio(8);

      rank="<b>Bishop</b>";
      rank_label.html(rank);

      cathedral_block_flag=2;
      cathedral_block.hide();
      church_block.hide();

      if(pilgrimage==1){
      statue_upgrade_flag=1;
      statue_block.show();
      }

      vatican_upgrade_flag=1;
      vatican_block.show();

      money=money-cathedral_upgrade_price;

      boxes+=500000*churches;

      SaveGame();
      InventoryUpdate();
    });

    makeboxing_prestige_upgrade.click(function(){
      PlayAudio(1);

      makeboxing_multiplier=10;
      makeboxing_prestige_upgrade.text("Used");
      makeboxing_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      Init();

    });

    praying_prestige_upgrade.click(function(){
      PlayAudio(1);

      praying_multiplier=4;
      praying_prestige_upgrade.text("Used");
      praying_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      Init();

    });

    speed_prestige_upgrade.click(function(){
      PlayAudio(1);

      speed_multiplier=0.1;
      speed_prestige_upgrade.text("Used");
      speed_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      Init();

    });

    pilgrimage_prestige_upgrade.click(function(){
      PlayAudio(1);

      pilgrimage=1;
      pilgrimage_prestige_upgrade.text("Used");
      pilgrimage_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');

      Pilgrimage();

      Init();

    });

    tax_prestige_upgrade.click(function(){
      PlayAudio(1);

      if(tax<10){
        tax=10;
        $("#tax_prestige_text").text("Lobbying. Increase church tax by $5 per box");
      }
      else{tax+=5;}


      tax_upgrade.text("$"+tax+" per box");
      current_tax_label.text(tax);

      Init();

    });

    reset_game.click(function(){
      localStorage.removeItem("popeGameData");
      $("#endgame_block").text("Game data reset. Reload page.");
    });

  });//document.ready

  function Pray(){

    var num=0;

    //if(holiness==0){
      //holiness_sign.removeClass('prestige_counter_highlight').addClass('prestige_counter');
    //}

    pray_interval=setInterval(function() {
      num++;
      PrayDisable();
      progress(num,makebox_pb);

      if(num>=100){
        clearInterval(pray_interval);
        holiness+=praying_multiplier;
        HolinessUpdate();

        PrestigeUpdate(1000);

        PlayAudio(2);

        progress(0,makebox_pb);PrayEnable();

      }

    }, 10);
  }

  function Monk(){

      var num=0;

      monk_pb.show();

      monk_interval=setInterval(function() {

        num++;
        if(num>100)num=0;
        progress(num,monk_pb);

        if(num>=100){
          holiness+=monks*praying_multiplier;
          HolinessUpdate();

          InventoryUpdate();

          PrestigeUpdate(100*monks);
          PlayAudio(3);

        }

      }, 10);

  }

  function makebox(){

    var num=0;

    makebox_interval=setInterval(function() {

      num++;
      makeboxDisable();
      progress(num,makebox_pb);

      if(num>=100){
        clearInterval(makebox_interval);
        boxes+=makeboxing_multiplier;
        money+=Math.floor((Math.random() * 500) + 1)*makeboxing_multiplier;
        InventoryUpdate();

        PrestigeUpdate(1*makeboxing_multiplier);

        PlayAudio(2);

        if(store_table_flag==0 && boxes>=5){
          store_table_flag=1;
          prestige_progress=0;
          prestige_label.text(prestige_progress);
          store_table.show();
          prestige_counter.show();
        }

        progress(0,makebox_pb);makeboxEnable();

      }

    }, 10);
  }

  function boxmaker(){

      var num=0;

      boxmaker_pb.show();

      boxmaker_interval=setInterval(function() {

        num++;
        if(num>100)num=0;
        progress(num,boxmaker_pb);

        if(num>=100){
          boxes+=boxmakers*makeboxing_multiplier;
          money+=(Math.floor((Math.random() * 500) + 1))*boxmakers*makeboxing_multiplier;
          InventoryUpdate();

          PrestigeUpdate(1*boxmakers*makeboxing_multiplier);
          PlayAudio(3);

        }

      }, 10);

  }

  function BuildChurch(){

    churches++;

    if(churches<10){
      church_label.text(churches+"/10");
    }else{church_label.text(churches);}


    boxes+=5000*churches;

    money=money-church_upgrade_price;

    church_upgrade_price=Math.ceil(church_upgrade_price+church_upgrade_price*0.3);

    if(churches==1){
      rank="<b>Priest</b>";
      rank_label.html(rank);
      PlayAudio(8);
      SaveGame();
    }

    if(churches==10){
      cathedral_block_flag=1;
      cathedral_block.show();
      PlayAudio(4);
      SaveGame();
    }

    church_upgrade.text("$" + numT(church_upgrade_price));
    InventoryUpdate();

    PrestigeUpdate(10000);
  }

  function SaveGame(){
    let gameData = {
      player: [money,prestige_progress,prestige_limit,rank,holiness,holiness_limit],
      entities: [boxes,boxmakers,monks,churches],
      ui: [css_flag,store_table_flag,monastery_block_flag,small_church_block_flag,cathedral_block_flag,statue_upgrade_flag,vatican_upgrade_flag,bishop_upgrade_flag],
      prices: [boxmaker_upgrade_price,church_upgrade_price,monk_upgrade_price,bishop_upgrade_price],
      prestige: [pilgrimage,speed_multiplier,makeboxing_multiplier,tax,praying_multiplier]
    };
    //let gameDataJSON = JSON.stringify(gameData);
    //localStorage.setItem("popeGameData", gameDataJSON);
    localStorage.setItem('popeGameData', LZString.compressToBase64(JSON.stringify(gameData)));
  }

  function LoadGame(){
    let gameData=localStorage.getItem('popeGameData');
    gameData = JSON.parse(LZString.decompressFromBase64(gameData));

    //console.log(gameData);

    //PLAYER
    money=parseInt(gameData.player[0]);//set by InventoryUpdate()
    prestige_progress=parseInt(gameData.player[1]);prestige_label.text(numT(prestige_progress));
    prestige_limit=parseInt(gameData.player[2]);prestige_limit_label.text(numT(prestige_limit));
                if(prestige_progress>=prestige_limit){
                  prestige_limit_flag=1;
                  prestige_table.show();
                }
    rank=gameData.player[3];rank_label.html(rank);
    holiness=parseInt(gameData.player[4]);holiness_label.text(numT(holiness));
    holiness_limit=parseInt(gameData.player[5]);holiness_limit_label.text(numT(holiness_limit));
                if(holiness>=1000){
                  holiness_level++;
                  holywater_block.show();
                }
                if(holiness>=4000){
                  holiness_level++;
                  sins_block.show();
                }
                if(holiness>=7000){
                  holiness_level++;
                  dj_block.show();
                }
                if(holiness>=10000){
                  holiness_level++;
                  tele_block.show();
                }
                if(holiness>=13000){
                  holiness_level++;
                  tax_block.show();
                  holiness_block.hide();
                  holiness_complete_block.show();
                }


    //ENTITIES
    boxes=parseInt(gameData.entities[0]);//set by InventoryUpdate()
    boxmakers=parseInt(gameData.entities[1]);boxmaker_label.text(boxmakers);if(boxmakers>0){boxmaker();}
    monks=parseInt(gameData.entities[2]);monk_label.text(monks);if(monks>0){setTimeout('Monk();',250);monk_block.show();}
    churches=parseInt(gameData.entities[3]);
                if(churches<10){
                  church_label.text(churches+"/10");
                }else{church_label.text(churches);}

    //PRICES
    boxmaker_upgrade_price=parseInt(gameData.prices[0]);boxmaker_upgrade.text( numT(boxmaker_upgrade_price) + " boxes" );
    church_upgrade_price=parseInt(gameData.prices[1]);church_upgrade.text("$" + numT(church_upgrade_price));
    monk_upgrade_price=parseInt(gameData.prices[2]);monk_upgrade.text( "$" + numT(monk_upgrade_price) );
    bishop_upgrade_price=parseInt(gameData.prices[3]);bishop_upgrade.text( "$" + numT(bishop_upgrade_price) );

    //UI
    bishop_upgrade_flag=parseInt(gameData.ui[7]);
                if(bishop_upgrade_flag==1){
                  bishop_block.show();
                  pope_block.show();
                }
    vatican_upgrade_flag=parseInt(gameData.ui[6]);
                if(vatican_upgrade_flag==1){
                  vatican_block.show();
                }else if(vatican_upgrade_flag==2){
                  vatican_block.hide();
                }
    statue_upgrade_flag=parseInt(gameData.ui[5]);
                if(statue_upgrade_flag==1){
                  statue_block.show();
                }else if(statue_upgrade_flag==2){
                  statue_block.hide();
                  pilgrimage=2;
                }
    cathedral_block_flag=parseInt(gameData.ui[4]);
                if(churches>=5 && cathedral_block_flag==1){
                  cathedral_block.show();
                }
    small_church_block_flag=parseInt(gameData.ui[3]);
                if(small_church_block_flag==1){
                  small_church_block.show();
                }else{
                  small_church_block.hide();
                  if(holiness<13000){holiness_block.show();}
                  pray_button.show();
                  makebox_button.hide();

                  wedding_block.show();
                  if(cathedral_block_flag!=2){church_block.show();}
                }

    monastery_block_flag=parseInt(gameData.ui[2]);
                if(monastery_block_flag==1){
                  monastery_block.show();
                }

    store_table_flag=parseInt(gameData.ui[1]);
                if(store_table_flag==1){
                  store_table.show();
                  prestige_counter.show();
                }

    css_flag=parseInt(gameData.ui[0]);
                if(css_flag==2){
                  $("#currentStyle").attr( "href", dark.attr("id") + ".css" );
                  dark.hide();
                  light.show();
                }

    //PRESTIGE
    praying_multiplier=parseInt(gameData.prestige[4]);
                if(praying_multiplier==4){
                  praying_prestige_upgrade.text("Used");
                  praying_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');
                }
    tax=parseInt(gameData.prestige[3]);
                  tax_upgrade.text("$"+tax+" per box");
                  current_tax_label.text(tax);
    makeboxing_multiplier=parseInt(gameData.prestige[2]);
                if(makeboxing_multiplier==10){
                  makeboxing_prestige_upgrade.text("Used");
                  makeboxing_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');
                }
    speed_multiplier=parseFloat(gameData.prestige[1]);
                if(speed_multiplier==0.1){
                  speed_prestige_upgrade.text("Used");
                  speed_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');
                }
    pilgrimage=parseInt(gameData.prestige[0]);
                if(pilgrimage!=0){
                  pilgrimage_prestige_upgrade.text("Used");
                  pilgrimage_prestige_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');
                }
                if(pilgrimage==1){
                  Pilgrimage();
                }

    if(tax>=10){
      $("#tax_prestige_text").text("Lobbying. Increase church tax by $5 per box");
    }

    InventoryUpdate();

  }

  function HolinessUpdate(){
    if(holiness>=holiness_limit){

      if(holiness_level==0 && holiness>=1000){
        holiness_level++;
        holywater_block.show();
        PlayAudio(7);
      }

      if(holiness_level==1 && holiness>=4000){
        holiness_level++;
        sins_block.show();
        PlayAudio(7);
      }

      if(holiness_level==2 && holiness>=7000){
        holiness_level++;
        dj_block.show();
        PlayAudio(7);
      }

      if(holiness_level==3 && holiness>=10000){
        holiness_level++;
        tele_block.show();
        PlayAudio(7);
      }

      if(holiness_level==4 && holiness>=13000){
        holiness_level++;
        tax_block.show();
        holiness_block.hide();
        holiness_complete_block.show();
        PlayAudio(7);
      }

      holiness_limit=holiness_limit+3000;

      SaveGame();

    }

    if(monastery_block_flag==0 && holiness>=5){
      monastery_block_flag=1;
      monastery_block.show();
      PlayAudio(7);
    }

    holiness_label.text(numT(holiness));
    holiness_limit_label.text(numT(holiness_limit));
  }

  function InventoryUpdate(){
    boxes_label.text(numT(boxes));
    money_label.text(numT(money));
    StoreState();

    let ch = Math.floor((Math.random() * 100) + 1);
    if(ch==5){SaveGame();}
  }

  function PrestigeUpdate(num){
    prestige_progress+=num;
    prestige_label.text(numT(prestige_progress));

    if(prestige_limit_flag==0 && prestige_progress>=prestige_limit){
      PlayAudio(6);
      prestige_limit_flag=1;
      prestige_table.show();
    }
  }

  function Init(){

    //PLAYER
    holiness=0;holiness_label.text(0);
    holiness_limit=1000;holiness_limit_label.text(numT(holiness_limit));
    holiness_level=0;
    rank="<b>boxmaker</b>";rank_label.html(rank);
    money=0;money_label.text(numT(money));

    //ENTITIES
    boxes=0;boxes_label.text(boxes);
    boxmakers=0;boxmaker_label.text(boxmakers);
    monks=0;monk_label.text(monks);
    churches=0;church_label.text("0/10");

    //LOOPS
    clearInterval(boxmaker_interval);
    clearInterval(monk_interval);
    clearInterval(wedding_interval);
    clearInterval(holywater_interval);
    clearInterval(makebox_interval);
    clearInterval(pray_interval);
    clearInterval(sins_interval);
    clearInterval(tax_interval);
    clearInterval(tele_interval);
    clearInterval(dj_interval);

    //UI
    store_table.hide();
    wedding_block.hide();
    dj_block.hide();
    holywater_block.hide();
    sins_block.hide();
    tax_block.hide();
    tele_block.hide();
    statue_block.hide();
    vatican_block.hide();
    bishop_block.hide();
    pope_block.hide();
    monastery_block.hide();
    monk_block.hide();
    church_block.hide();
    cathedral_block.hide();
    small_church_block.show();
    holiness_block.hide();
    holiness_complete_block.hide();
    pray_button.hide();
    makebox_button.show();
    prestige_table.hide();
    prestige_counter.hide();
    prestige_hide.html("Hide Prestige &#x25B2;");
    $(".prestige_item").show();

    //progress bars
    sins_pb.hide();progress(0,sins_pb);
    tax_pb.hide();progress(0,tax_pb);
    wedding_pb.hide();progress(0,wedding_pb);
    holywater_pb.hide();progress(0,holywater_pb);
    boxmaker_pb.hide();progress(0,boxmaker_pb);
    monk_pb.hide();progress(0,monk_pb);
    tele_pb.hide();progress(0,tele_pb);
    dj_pb.hide();progress(0,dj_pb);
    progress(0,makebox_pb);
    //buttons (these are "truck" loops, not managed by StoreState)
    holywater_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
    wedding_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
    tax_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
    sins_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
    dj_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');
    tele_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');

    //ui flags
    store_table_flag=0;
    monastery_block_flag=0;
    small_church_block_flag=1;
    cathedral_block_flag=0;
    prestige_hide_flag=0;
    statue_upgrade_flag=0;
    vatican_upgrade_flag=0;
    bishop_upgrade_flag=0;

    //PRICES
    boxmaker_upgrade_price=10;boxmaker_upgrade.text( numT(boxmaker_upgrade_price) + " boxes" );
    church_upgrade_price=1000000;church_upgrade.text( "$" + numT(church_upgrade_price) );
    small_church_upgrade_price=100000;//fixed price
    monastery_upgrade_price=500000;//fixed price
    vatican_upgrade_price=500000000;vatican_upgrade.text( "$" + numT(vatican_upgrade_price) ); //fixed price
    monk_upgrade_price=1000;monk_upgrade.text( "$" + numT(monk_upgrade_price) );
    bishop_upgrade_price=500000;bishop_upgrade.text( "$" + numT(bishop_upgrade_price) );

    //PRESTIGE VARIABLES
    prestige_progress=0;
    prestige_limit_flag=0;
    if(prestige_limit==0){prestige_limit=500000;}else{
      prestige_limit=prestige_limit+prestige_limit*0.3;
    }
    prestige_limit_label.text(numT(prestige_limit));

    if(pilgrimage==2){pilgrimage=1;Pilgrimage();}//resetting the sold statue

    SaveGame();

  }

  function Pilgrimage(){

    pilgrim_interval=setInterval(function() {

      money+=1000;
      money_label.text(numT(money));
      PrestigeUpdate(100);

    }, 500);

  }

  function StoreState(){

    if(boxes-boxmaker_upgrade_price>=0){boxmaker_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{boxmaker_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-small_church_upgrade_price>=0){small_church_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{small_church_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-church_upgrade_price>=0){church_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{church_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-monastery_upgrade_price>=0){monastery_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{monastery_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-monk_upgrade_price>=0){monk_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{monk_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-cathedral_upgrade_price>=0){cathedral_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{cathedral_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-vatican_upgrade_price>=0){vatican_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{vatican_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(money-bishop_upgrade_price>=0){bishop_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{bishop_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

    if(boxes-pope_upgrade_price>=0){pope_upgrade.prop('disabled', false).removeClass('disabled2').addClass('button2');}
    else{pope_upgrade.prop('disabled', true).removeClass('button2').addClass('disabled2');}

  }

  function EndGame(){
    //LOOPS
    clearInterval(boxmaker_interval);
    clearInterval(monk_interval);
    clearInterval(wedding_interval);
    clearInterval(holywater_interval);
    clearInterval(makebox_interval);
    clearInterval(pray_interval);
    clearInterval(sins_interval);
    clearInterval(tax_interval);
    clearInterval(tele_interval);
    clearInterval(dj_interval);
    clearInterval(pilgrim_interval);

    store_table.hide();
    inventory_table.hide();
    prestige_table.hide();
    player_table.hide();
    $("#endgame_block").show();

  }

  function makeboxEnable(){
    makebox_button.prop('disabled', false).removeClass('disabled1').addClass('button1');
  }
  function makeboxDisable(){
    makebox_button.prop('disabled', true).removeClass('button1').addClass('disabled1');
  }
  function PrayEnable(){
    pray_button.prop('disabled', false).removeClass('disabled1').addClass('button1');
  }
  function PrayDisable(){
    pray_button.prop('disabled', true).removeClass('button1').addClass('disabled1');
  }

  function numT(number, decPlaces=2) { //numTransform
  					// 2 decimal places => 100, 3 => 1000, etc
  					decPlaces = Math.pow(10,decPlaces);
  					// Enumerate number abbreviations
  					var abbrev = [ "k", "M", "B", "T", "q", "Q", "s", "S", "o", "n", "d", "U", "D", "Td", "Qt", "Qd", "Sd", "St", "O", "N", "v", "c", "Na", "kNa", "Nb", "kNb", "Nc", "kNc", "Nd", "kNd", "Ne", "kNe", "Nf", "kNf", "Ng", "kNg", "Nh", "kNh", "Ni", "kNi", "Nj", "kNj", "Nk", "kNk", "Nl", "kNl", "Nm", "kNm", "Nn", "kNn", "No", "kNo", "Np", "kNp", "Nq", "kNq", "Nr", "kNr", "Ns", "kNs", "Nt", "kNt", "Nu", "kNu", "Nv", "kNv", "Nw", "kNw", "Nx", "kNx", "Ny", "kNy", "Nz", "kNz", "cX", "ccX", "dX", "ddX", "eX", "eeX", "fX", "ffX", "gX", "ggX", "hx", "hhX", "iX", "iiX", "jX", "jjX", "kX", "kkX", "lX", "llX", "mX", "mmX", "nX", "nnX", "oX", "ooX", "pX", "ppX", "qX", "qqX", "rX", "rrX", "sX", "ssX", "tX", "ttX", "uX", "uuX", "vX", "vvX", "wX", "wwX", "xX", "xxX", "yX", "yyX", "zX", "zzX", "cM", "ccM", "dM", "ddM", "eM", "eeM", "fM", "ffM", "gM", "ggM", "hM", "hhM", "iM", "iiM", "jM", "jjM", "kM", "kkM", "lM", "llM", "nM", "nnM", "oM", "ooM", "pM", "ppM", "qM", "qqM", "rM", "rrM", "sM", "ssM", "tM", "ttM", "uM", "uuM", "vM", "vvM", "wM", "wwM", "xM", "xxM", "yM", "yyM", "zM", "zzM" ];
  					// Go through the array backwards, so we do the largest first
  					for (var i=abbrev.length-1; i>=0; i--) {
  							// Convert array index to "1000", "1000000", etc
  							var size = Math.pow(10,(i+1)*3);
  							// If the number is bigger or equal do the abbreviation
  							if(size <= number) {
  									 // Here, we multiply by decPlaces, round, and then divide by decPlaces.
  									 // This gives us nice rounding to a particular decimal place.
  									 number = Math.round(number*decPlaces/size)/decPlaces;
  									 // Handle special case where we round up to the next abbreviation
  									 if((number == 1000) && (i < abbrev.length - 1)) {
  											 number = 1;
  											 i++;
  									 }
  									 // Add the letter for the abbreviation
  									 number += " "+abbrev[i];
  									 // We are done... stop
  									 break;
  							}
  					}
  					return number;
  		}

  function progress(percent, $element, speed=0) {
    var progressBarWidth = percent * $element.width() / 100;
    $element.find('div').animate({ width: progressBarWidth }, speed);
  }

  function PlayAudio(snd){
    switch(snd){
      case 1: $("#audio_click")[0].cloneNode(true).play(); break;
      case 2: $("#audio_box")[0].cloneNode(true).play(); break;
      case 3: $("#audio_tick")[0].cloneNode(true).play(); break;
      case 4: $("#audio_church")[0].cloneNode(true).play(); break;
      case 5: $("#audio_building")[0].cloneNode(true).play(); break;
      case 6: $("#audio_prestige")[0].cloneNode(true).play(); break;
      case 7: $("#audio_holiness")[0].cloneNode(true).play(); break;
      case 8: $("#audio_rank")[0].cloneNode(true).play(); break;
      case 9: $("#audio_pope")[0].cloneNode(true).play(); break;
      }
    }

</script>

<div class="all" id="all">

  <!--PLAYER-->
  <table id="player_table">
    <tr>
      <td>Rank: <span id="rank_label"><b>boxmaker</b></span></td>
    </tr>
    <tr id="holiness_block" style="display:none">
      <td class="prestige_counter" id="holiness_sign">Holiness: <span id="holiness_label">0</span>/<span id="holiness_limit_label">1 k</span></td>
    </tr>
    <tr id="holiness_complete_block" style="display:none">
      <td class="prestige_counter">Holiness: Complete Saint</td>
    </tr>
    <tr>
      <td><div id="makebox_pb" class="pb"><div></div></div></td>
    </tr>
    <tr>
      <td><button class="button1" id="makebox_button">makebox</button><button class="button1" id="pray_button" style="display:none">Pray</button></td>
    </tr>
  </table>

  <br>

  <!--INVENTORY-->
  <table id="inventory_table">
    <tr>
      <td>
        boxes:
      </td>
      <td><span id="boxes_label">0</span></td>
    </tr>
    <tr>
      <td>
        Donations:
      </td>
      <td>$<span id="money_label">0</span></td>
    </tr>
    <tr id="prestige_counter" style="display:none">
      <td class="prestige_counter">
        Prestige:
      </td>
      <td class="prestige_counter"><span id="prestige_label">0</span> / <span id="prestige_limit_label">x</span></td>
    </tr>
  </table>

  <br>
  <br>

  <!--PRESTIGE-->
  <table id="prestige_table" class="prestige" style="display:none">
    <tr class="prestige_hide">
      <td class="store_item_content" id="prestige_hide">
        Hide Prestige &#x25B2;
      </td>
    </tr>
    <tr class="prestige_item">
      <td class="store_item_content">
        Procure a statue with the ability to cry tears of blood: a steady inflow of pilgrims and donations<br><br>
        <button class="button2" id="pilgrimage_prestige_upgrade">Restart Game</button>
      </td>
    </tr>
    <tr class="prestige_item">
      <td class="store_item_content">
        Pact with the devil: speed up all commercial activities by 10<br><br>
        <button class="button2" id="speed_prestige_upgrade">Restart Game</button>
      </td>
    </tr>
    <tr class="prestige_item">
      <td class="store_item_content">
        Group psychosis. Increase the effectiveness of makeboxing by 10<br><br>
        <button class="button2" id="makeboxing_prestige_upgrade">Restart Game</button>
      </td>
    </tr>
    <tr class="prestige_item">
      <td class="store_item_content">
        Saint status. Quadruple the effectiveness of praying<br><br>
        <button class="button2" id="praying_prestige_upgrade">Restart Game</button>
      </td>
    </tr>
    <tr class="prestige_item">
      <td class="store_item_content">
        <span id="tax_prestige_text">Lobbying. Increase church tax to $10 per box</span><br>
        Current tax: $<span id=current_tax_label>1</span><br><br>
        <button class="button2" id="tax_prestige_upgrade">Restart Game</button>
      </td>
    </tr>
  </table>

  <!--STORE-->
  <table id="store_table" style="display:none">
    <tr>
      <td class="upgrades_container">
        <table class="store">

          <tr class="store_item" id="boxmaker_block">
            <td class="store_item_content">
              Recruit boxmakers to help you spread the word<br>
              boxmakers: <span id="boxmaker_label">0</span><br><br>
              <div id="boxmaker_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="disabled2" id="boxmaker_upgrade">10 boxes</button>
            </td>
          </tr>

          <tr class="store_item" id="small_church_block">
            <td class="store_item_content">
              Set up a small house church<br><br>
              <button class="disabled2" id="small_church_upgrade">$100 k</button>
            </td>
          </tr>

          <tr class="store_item" id="tele_block" style="display:none">
            <td class="store_item_content">
              Use a televangelist to convert more people<br><br>
              <div id="tele_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="button2" id="tele_upgrade">Go</button>
            </td>
          </tr>

          <tr class="store_item" id="church_block" style="display:none">
            <td class="store_item_content">
              Build a church. Every church adds more boxes<br>
              Churches: <span id="church_label">0/5</span><br><br>
              <button class="disabled2" id="church_upgrade">$2 M</button>
            </td>
          </tr>

          <tr class="store_item" id="monk_block" style="display:none">
            <td class="store_item_content">
              Invite a monk to make your mission holier<br>
              Monks: <span id="monk_label">0</span><br><br>
              <div id="monk_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="disabled2" id="monk_upgrade">$1 k</button>
            </td>
          </tr>

          <tr class="store_item" id="monastery_block" style="display:none">
            <td class="store_item_content">
              Build a monastery<br><br>
              <button class="disabled2" id="monastery_upgrade">$500 k</button>
            </td>
          </tr>

          <tr class="store_item" id="cathedral_block" style="display:none">
            <td class="store_item_content">
              Build a cathedral to become Bishop<br><br>
              <button class="disabled2" id="cathedral_upgrade">$50 M</button>
            </td>
          </tr>

          <tr class="store_item" id="vatican_block" style="display:none">
            <td class="store_item_content">
              Make a small donation to Vatican to become Cardinal<br><br>
              <button class="disabled2" id="vatican_upgrade">$500 M</button>
            </td>
          </tr>

          <tr class="store_item" id="pope_block" style="display:none">
            <td class="store_item_content">
              Become Pope<br><br>
              <button class="disabled2" id="pope_upgrade">1 B boxes</button>
            </td>
          </tr>

          <tr class="store_item" id="bishop_block" style="display:none">
            <td class="store_item_content">
              Support a bishop to assign their boxes to your own<br><br>
              <button class="disabled2" id="bishop_upgrade">$500 k</button>
            </td>
          </tr>

        </table>
      </td>



      <td class="upgrades_container">
        <table class="store">

          <tr class="store_item" id="wedding_block" style="display:none">
            <td class="store_item_content">
              Conduct a wedding ceremony<br><br>
              <div id="wedding_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="button2" id="wedding_upgrade">Earn $50 k</button>
            </td>
          </tr>

          <tr class="store_item" id="holywater_block" style="display:none">
            <td class="store_item_content">
              Sell holy water<br><br>
              <div id="holywater_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="button2" id="holywater_upgrade">Earn $100 k</button>
            </td>
          </tr>

          <tr class="store_item" id="sins_block" style="display:none">
            <td class="store_item_content">
              Forgive sins<br><br>
              <div id="sins_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="button2" id="sins_upgrade">Earn $200 k</button>
            </td>
          </tr>

          <tr class="store_item" id="dj_block" style="display:none">
            <td class="store_item_content">
              Rent out a church for an epic DJ performance<br><br>
              <div id="dj_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="button2" id="dj_upgrade">Earn $500 k</button>
            </td>
          </tr>

          <tr class="store_item" id="tax_block" style="display:none">
            <td class="store_item_content">
              Collect church tax<br><br>
              <div id="tax_pb" class="pb2" style="display:none"><div></div></div><br>
              <button class="button2" id="tax_upgrade">$1 per box</button>
            </td>
          </tr>

          <tr class="store_item" id="statue_block" style="display:none">
            <td class="store_item_content">
              Sell the statue that cries blood to a private worshipper<br><br>
              <button class="button2" id="statue_upgrade">Earn $300 M</button>
            </td>
          </tr>



        </table>
      </td>
    </tr>
  </table>

  <!--RESUME GAME-->
  <div id="resume_game_block" style="display:none"><button class="button1" id="resume_game">Resume game</button></div>

  <!--ENDGAME-->
  <div id="endgame_block" style="display:none;width:50%">
    You are now <b>Pope</b>, head of the worldwide Catholic Church, and head of state of Vatican City. Your spiritual influence extends across a billion people.
  </div>

</div>

<br><br>



<div class="footer">
  <button class="button2" id="dark">Dark mode</button>
  <button class="button2" id="light" style="display:none">Light mode</button>
  <span class="signature"><a class="standard" href="https://twitter.com/BoxicKnowsBest">Louigi Verona's Workshop</a></span>
</div>

<audio id="audio_tick" src="snd/tick2.wav" preload="auto"></audio>
<audio id="audio_click" src="snd/click4.wav" preload="auto"></audio>
<audio id="audio_box" src="snd/box2.wav" preload="auto"></audio>
<audio id="audio_church" src="snd/church2.wav" preload="auto"></audio>
<audio id="audio_prestige" src="snd/prestige.wav" preload="auto"></audio>
<audio id="audio_building" src="snd/building.wav" preload="auto"></audio>
<audio id="audio_holiness" src="snd/holiness.wav" preload="auto"></audio>
<audio id="audio_rank" src="snd/rank.wav" preload="auto"></audio>
<audio id="audio_pope" src="snd/pope.wav" preload="auto"></audio>

</body>
</html>
